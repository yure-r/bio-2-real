var THREEx=THREEx||{};THREEx.DayNight={},THREEx.DayNight.baseURL="../",THREEx.DayNight.currentPhase=function(t){return Math.sin(t)>Math.sin(0)?"day":Math.sin(t)>Math.sin(-Math.PI/6)?"twilight":"night"},THREEx.DayNight.StarField=function(){var t=THREE.ImageUtils.loadTexture(THREEx.DayNight.baseURL+"images/galaxy_starfield.png"),a=new THREE.MeshBasicMaterial({map:t,side:THREE.BackSide,color:8421504}),o=new THREE.SphereGeometry(1e4,32,32),e=new THREE.Mesh(o,a);this.object3d=e,this.update=function(t){var o=THREEx.DayNight.currentPhase(t);if("day"===o)e.visible=!1;else if("twilight"===o)e.visible=!1;else{e.visible=!0,e.rotation.y=t/5;var i=Math.abs(Math.sin(t));a.color.setRGB(i,i,i)}}},THREEx.DayNight.SunLight=function(){var t=new THREE.DirectionalLight(16777215,1);t.castShadow=!0,t.shadow.mapSize.width=12096,t.shadow.mapSize.height=12096,t.shadow.camera.near=.05,t.shadow.camera.far=1e3;const a=300,o=new THREE.Object3D;scene.add(o),o.translateX(110),o.translateZ(110),t.target=o,t.shadow.camera.left=-a,t.shadow.camera.right=a,t.shadow.camera.top=a,t.shadow.camera.bottom=-a,t.shadow.bias=-5e-4,this.object3d=t,this.update=function(a){Math.sin(a)<Math.sin(0)&&Math.sin(a)<Math.sin(-Math.PI/9)?t.castShadow=!1:t.castShadow=!0,t.position.x=110,t.position.y=350*Math.sin(a),t.position.z=110+350*Math.cos(a);var o=THREEx.DayNight.currentPhase(a);"day"===o?(t.intensity=10,t.color.set("rgb(255,"+(Math.floor(200*Math.sin(a))+55)+","+Math.floor(200*Math.sin(a))+")")):"twilight"===o?(t.intensity=5,t.color.set("rgb("+(255-Math.floor(510*Math.sin(a)*-1))+","+(55-Math.floor(110*Math.sin(a)*-1))+",0)")):(t.intensity=.3,t.color.set("rgb(255,255,255)")),Math.sin(a)<Math.sin(0)&&(Math.sin(a),Math.sin(-Math.PI/9)),t.intensity=.3,t.color.set("rgb(255,255,255)")}},THREEx.DayNight.MoonLight=function(){var t=new THREE.DirectionalLight(16777215,1);t.castShadow=!0,t.shadowMapCullFrontFaces=!0,t.shadow.mapSize.width=12096,t.shadow.mapSize.height=12096,t.shadow.camera.near=.05,t.shadow.camera.far=1e3;const a=300;t.shadow.camera.left=-a,t.shadow.camera.right=a,t.shadow.camera.top=a,t.shadow.camera.bottom=-a,t.shadow.bias=-5e-4;const o=new THREE.CameraHelper(t.shadow.camera);scene.add(o),this.object3d=t,this.update=function(a){t.position.x=0,t.position.y=-350*Math.sin(a),t.position.z=-350*Math.cos(a);var o=THREEx.DayNight.currentPhase(a);"day"===o?t.color.set("rgb(0,"+(Math.floor(200*Math.sin(a))+55)+","+Math.floor(200*Math.sin(a))+")"):"twilight"===o?(t.intensity=1,t.color.set("rgb(0,"+(55-Math.floor(110*Math.sin(a)*-1))+","+(255-Math.floor(510*Math.sin(a)*-1))+")")):(t.intensity=.3,t.color.set("rgb(255,255,255)"))}},THREEx.DayNight.SunSphere=function(){var t=new THREE.SphereGeometry(20,30,30),a=new THREE.MeshBasicMaterial({color:16711680}),o=new THREE.Mesh(t,a);this.object3d=o,this.update=function(t){o.position.x=0,o.position.y=400*Math.sin(t),o.position.z=400*Math.cos(t);var a=THREEx.DayNight.currentPhase(t);"day"===a?o.material.color.set("rgb(255,"+(Math.floor(200*Math.sin(t))+55)+","+(Math.floor(200*Math.sin(t))+5)+")"):"twilight"===a&&o.material.color.set("rgb(255,55,5)")}},THREEx.DayNight.Skydom=function(){var t=new THREE.SphereGeometry(7e3,32,15),a=THREEx.DayNight.Skydom.Shader,o=THREE.UniformsUtils.clone(a.uniforms),e=new THREE.ShaderMaterial({vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,uniforms:o,side:THREE.BackSide}),i=new THREE.Mesh(t,e);this.object3d=i,this.update=function(t){var a=THREEx.DayNight.currentPhase(t);"day"===a?(o.topColor.value.set("rgb(0,120,255)"),o.bottomColor.value.set("rgb(255,"+(Math.floor(200*Math.sin(t))+55)+","+Math.floor(200*Math.sin(t))+")")):"twilight"===a?(o.topColor.value.set("rgb(0,"+(120-Math.floor(240*Math.sin(t)*-1))+","+(255-Math.floor(510*Math.sin(t)*-1))+")"),o.bottomColor.value.set("rgb("+(255-Math.floor(510*Math.sin(t)*-1))+","+(55-Math.floor(110*Math.sin(t)*-1))+",0)")):(o.topColor.value.set("black"),o.bottomColor.value.set("black"))}},THREEx.DayNight.Skydom.Shader={uniforms:{topColor:{type:"c",value:(new THREE.Color).setHSL(.6,1,.75)},bottomColor:{type:"c",value:new THREE.Color(16777215)},offset:{type:"f",value:2400},exponent:{type:"f",value:.9}},vertexShader:["varying vec3 vWorldPosition;","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","varying vec3 vWorldPosition;","void main() {","\tfloat h = normalize( vWorldPosition + offset ).y;","\tgl_FragColor = vec4( mix( bottomColor, topColor, max( pow( h, exponent ), 0.0 ) ), 1.0 );","}"].join("\n")};